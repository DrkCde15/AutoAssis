<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>NOG • Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body {
            background: #0a1430;
            color: #fff;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 16px;
            background: #0b1a3a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        button {
            background: #2563eb;
            border: none;
            padding: 10px 14px;
            color: #fff;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }

        #messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .msg-user {
            margin-bottom: 14px;
            color: #93c5fd;
        }

        .msg-bot {
            margin-bottom: 20px;
            color: #e5e7eb;
        }

        footer {
            padding: 16px;
            background: #0b1a3a;
            display: flex;
            gap: 10px;
        }

        input {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            outline: none;
        }
    </style>
</head>
<body>

<header>
    <strong>NOG • Chat</strong>
    <button id="logout">Sair</button>
</header>

<div id="messages"></div>

<footer>
    <input id="messageInput" placeholder="Digite sua mensagem...">
    <button id="send">Enviar</button>
</footer>

<script>
const TOKEN_KEY = 'access_token';
const token = localStorage.getItem(TOKEN_KEY);

if (!token) {
    window.location.href = '/login';
}

const messagesDiv = document.getElementById('messages');
const input = document.getElementById('messageInput');

function addMessage(text, cls) {
    const div = document.createElement('div');
    div.className = cls;
    div.textContent = text;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

document.getElementById('send').addEventListener('click', async () => {
    const msg = input.value.trim();
    if (!msg) return;

    addMessage('Você: ' + msg, 'msg-user');
    input.value = '';

    try {
        const res = await fetch('/api/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({ message: msg })
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Erro no chat');

        addMessage('NOG: ' + data.response, 'msg-bot');

    } catch (err) {
        addMessage('Erro: ' + err.message, 'msg-bot');
    }
});

document.getElementById('logout').addEventListener('click', () => {
    localStorage.removeItem(TOKEN_KEY);
    window.location.href = '/login';
});
</script>

</body>
</html>
