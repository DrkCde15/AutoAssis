<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>NOG ‚Ä¢ Assistente Automotivo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- MARKDOWN -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- DOMPurify para sanitiza√ß√£o XSS -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

    <!-- FONT -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- ICONS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            margin: 0;
            background: linear-gradient(180deg, #0b1a3a, #0a1430);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-container {
            width: 100%;
            max-width: 900px; /* Reduzido de 1100px para 900px */
            height: 90vh;
            background: rgba(255,255,255,0.03);
            border-radius: 18px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0,0,0,0.4);
        }

        .chat-header {
            padding: 18px 24px;
            background: rgba(0,0,0,0.35);
            font-weight: 600;
            color: #fff;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            flex: 1;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .user-name {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
        }

        .category-select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 13px;
            cursor: pointer;
        }

        .category-select:focus {
            outline: none;
            border-color: #2563eb;
        }

        .logout-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(239, 68, 68, 0.2);
            color: #fecaca;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .chat-messages {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            overflow-x: hidden;
            max-width: 100%;
        }

        .message {
            display: flex;
            margin-bottom: 18px;
            animation: slideIn 0.3s ease-out;
            max-width: 100%;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.loading {
            justify-content: flex-start;
        }

        .bubble {
            max-width: 65%; /* Alterado de 75% para 65% */
            padding: 14px 18px;
            border-radius: 16px;
            font-size: 15px;
            line-height: 1.6;
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
            hyphens: auto; /* Adiciona hifens para quebra de palavras longas */
            white-space: pre-wrap;
            overflow: hidden;
        }

        .bubble * {
            max-width: 100%;
        }

        .user .bubble {
            background: #2563eb;
            color: #fff;
            border-bottom-right-radius: 4px;
        }

        .ai .bubble {
            background: rgba(255,255,255,0.08);
            color: #e5e7eb;
            border-bottom-left-radius: 4px;
        }

        .error .bubble {
            background: rgba(239, 68, 68, 0.2);
            color: #fecaca;
            border-bottom-left-radius: 4px;
        }

        .bubble img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            margin-top: 10px;
            cursor: pointer;
        }

        .bubble img:hover {
            filter: brightness(1.1);
        }

        .bubble code {
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .bubble pre {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 8px 0;
            max-width: 100%;
            white-space: pre-wrap; /* Quebra linhas longas de c√≥digo */
        }

        .bubble pre code {
            background: none;
            padding: 0;
        }

        .bubble ul, .bubble ol {
            margin: 10px 0;
            padding-left: 24px;
            max-width: 100%;
            overflow-wrap: break-word;
        }

        .bubble li {
            margin: 6px 0;
            word-break: break-word;
        }

        .bubble p {
            margin: 8px 0;
        }

        .bubble p:first-child {
            margin-top: 0;
        }

        .bubble p:last-child {
            margin-bottom: 0;
        }

        .bubble h1, .bubble h2, .bubble h3 {
            margin: 12px 0 8px 0;
            font-weight: 600;
        }

        .bubble strong {
            font-weight: 600;
        }

        .bubble a {
            word-break: break-all;
        }

        .message-content {
            max-width: 100%;
            overflow: hidden;
        }

        .message-content * {
            max-width: 100%;
        }

        .loading-spinner {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e5e7eb;
            animation: bounce 1.4s infinite;
        }

        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                opacity: 0.3;
                transform: translateY(0);
            }
            40% {
                opacity: 1;
                transform: translateY(-8px);
            }
        }

        .chat-input {
            display: flex;
            padding: 16px;
            gap: 10px;
            background: rgba(0,0,0,0.35);
            align-items: center;
        }

        .input-wrapper {
            flex: 1;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .chat-input input {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            outline: none;
            font-size: 15px;
            background: rgba(255,255,255,0.05);
            color: #fff;
        }

        .chat-input input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .chat-input input:focus {
            border-color: #2563eb;
            background: rgba(255,255,255,0.08);
        }

        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            color: #fff;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: rgba(255,255,255,0.15);
        }

        .icon-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .send-btn {
            background: #2563eb;
            padding: 0 22px;
        }

        .send-btn:hover:not(:disabled) {
            background: #1e40af;
        }

        #imageInput {
            display: none;
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 8px;
        }

        .error-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            max-width: 400px;
            z-index: 1000;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .char-count {
            padding: 0 16px 8px;
            font-size: 12px;
            color: rgba(255,255,255,0.5);
            text-align: right;
            background: rgba(0,0,0,0.35);
        }

        .char-count.warning {
            color: #fbbf24;
        }

        .char-count.error {
            color: #ef4444;
        }

        /* Para telas menores */
        @media (max-width: 768px) {
            .chat-container {
                height: 100vh;
                border-radius: 0;
            }
            
            .chat-messages {
                padding: 16px;
            }
            
            .bubble {
                max-width: 85%;
                padding: 12px 16px;
                font-size: 14px;
            }
            
            .chat-header {
                padding: 14px 16px;
                font-size: 16px;
            }
            
            .header-actions {
                flex-wrap: wrap;
                gap: 8px;
            }
        }

        @media (max-width: 480px) {
            .bubble {
                max-width: 90%;
            }
            
            .category-select, .logout-btn {
                font-size: 12px;
                padding: 6px 10px;
            }
            
            .user-name {
                display: none;
            }
        }

        /* Para telas muito grandes, limitar ainda mais */
        @media (min-width: 1400px) {
            .chat-container {
                max-width: 800px;
            }
        }
        /* ===== COMPACTA√á√ÉO DE TEXTO DA IA ===== */
        .ai .bubble {
            line-height: 1.45; /* antes 1.6 */
        }

        .ai .bubble p {
            margin: 4px 0; /* antes 8px */
        }

        .ai .bubble ul,
        .ai .bubble ol {
            margin: 6px 0;
            padding-left: 20px;
        }

        .ai .bubble li {
            margin: 4px 0;
        }

        .ai .bubble h1,
        .ai .bubble h2,
        .ai .bubble h3 {
            margin: 8px 0 4px;
        }

        .ai .bubble br {
            line-height: 1;
        }

        /* Evita espa√ßamento exagerado por quebras do Markdown */
        .ai .bubble {
            white-space: normal;
        }

    </style>
</head>
<body>

<div class="chat-container">
    <div class="chat-header">
        <div class="header-title">NOG ‚Ä¢ Assistente Automotivo Virtual</div>
        <div class="header-actions">
            <span class="user-name" id="userName">Carregando...</span>
            <select id="category" class="category-select">
                <option value="geral">üìå Geral</option>
                <option value="tecnico">üîß T√©cnico</option>
                <option value="manutencao">üõ†Ô∏è Manuten√ß√£o</option>
                <option value="pecas">‚öôÔ∏è Pe√ßas</option>
                <option value="diagnostico">üîç Diagn√≥stico</option>
            </select>
            <button class="logout-btn" onclick="handleLogout()">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>
    </div>

    <div class="chat-messages" id="chat"></div>

    <div class="chat-input">
        <div class="input-wrapper">
            <input 
                type="text" 
                id="input" 
                placeholder="Digite sua mensagem..." 
                maxlength="2000"
            />
            <button id="imageBtn" class="icon-btn" title="Carregar imagem">
                <i class="fas fa-image"></i>
            </button>
            <input type="file" id="imageInput" accept="image/*" />
        </div>
        <button id="sendBtn" class="icon-btn send-btn" title="Enviar mensagem">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
    <div class="char-count" id="charCount"></div>
</div>

<script>
    // ==================== CONFIG ====================
    const MAX_MESSAGE_LENGTH = 2000;
    const TOKEN_KEY = 'access_token'; // CORRIGIDO: usar mesmo nome do auth.js
    
    const chat = document.getElementById("chat");
    const input = document.getElementById("input");
    const sendBtn = document.getElementById("sendBtn");
    const imageBtn = document.getElementById("imageBtn");
    const imageInput = document.getElementById("imageInput");
    const categorySelect = document.getElementById("category");
    const charCountEl = document.getElementById("charCount");
    const userNameEl = document.getElementById("userName");
    
    let isLoading = false;
    let selectedImage = null;
    let selectedImageData = null;

    // ==================== INIT ====================
    document.addEventListener("DOMContentLoaded", () => {
        console.log('üöÄ Inicializando chat...');
        checkAuth();
        loadUserInfo();
        loadChatHistory();
        setupEventListeners();
    });

    // ==================== AUTENTICA√á√ÉO ====================
    function checkAuth() {
        const token = localStorage.getItem(TOKEN_KEY);
        console.log('üîê Verificando token...', token ? 'Token encontrado' : 'Token n√£o encontrado');
        
        if (!token) {
            showError("Voc√™ precisa estar autenticado. Redirecionando...");
            setTimeout(() => window.location.href = "/login", 2000);
            return;
        }

        // Validar formato do token (deve ter 3 partes)
        const parts = token.split('.');
        if (parts.length !== 3) {
            console.error('‚ùå Token inv√°lido (n√£o tem 3 partes)');
            localStorage.removeItem(TOKEN_KEY);
            showError("Token inv√°lido. Redirecionando para login...");
            setTimeout(() => window.location.href = "/login", 2000);
            return;
        }

        console.log('‚úì Token v√°lido');
    }

    function getAuthHeaders() {
        const token = localStorage.getItem(TOKEN_KEY);
        if (!token) {
            console.error('‚ùå Tentando criar headers sem token');
            return {
                "Content-Type": "application/json"
            };
        }

        console.log('üì° Headers criados com token');
        return {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
        };
    }

    async function loadUserInfo() {
        try {
            console.log('üë§ Carregando informa√ß√µes do usu√°rio...');
            const res = await fetch("/api/user", {
                method: "GET",
                headers: getAuthHeaders()
            });

            if (res.status === 401) {
                console.error('‚ùå Token expirado ou inv√°lido');
                handleUnauthorized();
                return;
            }

            if (!res.ok) {
                throw new Error(`HTTP ${res.status}`);
            }

            const data = await res.json();
            if (data.nome) {
                userNameEl.textContent = data.nome;
                console.log('‚úì Usu√°rio carregado:', data.nome);
            }
        } catch (err) {
            console.error('Erro ao carregar usu√°rio:', err);
            userNameEl.textContent = 'Usu√°rio';
        }
    }

    function handleUnauthorized() {
        showError("Sess√£o expirada. Fa√ßa login novamente.");
        localStorage.removeItem(TOKEN_KEY);
        localStorage.removeItem('user_data');
        setTimeout(() => window.location.href = "/login", 2000);
    }

    async function handleLogout() {
        if (!confirm('Deseja realmente sair?')) {
            return;
        }

        try {
            // Tentar chamar API de logout
            await fetch("/api/logout", {
                method: "POST",
                headers: getAuthHeaders()
            });
        } catch (error) {
            console.error('Erro ao fazer logout:', error);
        } finally {
            // Limpar dados locais
            localStorage.removeItem(TOKEN_KEY);
            localStorage.removeItem('user_data');
            window.location.href = "/login";
        }
    }

    // ==================== EVENT LISTENERS ====================
    function setupEventListeners() {
        sendBtn.addEventListener("click", sendMessage);
        input.addEventListener("keydown", e => {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        imageBtn.addEventListener("click", () => imageInput.click());
        imageInput.addEventListener("change", handleImageUpload);
        input.addEventListener("input", updateCharCount);
    }

    // ==================== CHAR COUNT ====================
    function updateCharCount() {
        const len = input.value.length;
        if (len === 0) {
            charCountEl.textContent = "";
            charCountEl.className = "char-count";
            return;
        }

        charCountEl.textContent = `${len}/${MAX_MESSAGE_LENGTH}`;
        charCountEl.className = "char-count";

        if (len > MAX_MESSAGE_LENGTH * 0.8) {
            charCountEl.classList.add("warning");
        }
        if (len >= MAX_MESSAGE_LENGTH) {
            charCountEl.classList.add("error");
        }
    }

    // ==================== IMAGENS ====================
    function handleImageUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        // Validar tipo
        if (!file.type.startsWith("image/")) {
            showError("Por favor, selecione uma imagem v√°lida.");
            return;
        }

        // Validar tamanho (m√°x 5MB)
        if (file.size > 5 * 1024 * 1024) {
            showError("A imagem n√£o pode exceder 5MB.");
            return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
            selectedImageData = e.target.result;
            selectedImage = file.name;
            imageBtn.style.color = "#10b981";
            imageBtn.title = `Imagem carregada: ${file.name}`;
            console.log('‚úì Imagem carregada:', file.name);
        };
        reader.readAsDataURL(file);
    }

    // ==================== MENSAGENS ====================
    function sanitizeHTML(content) {
        // Parse markdown para HTML
        const parsed = marked.parse(content);
        
        // Sanitizar com DOMPurify (configura√ß√£o mais permissiva)
        const sanitized = DOMPurify.sanitize(parsed, {
            ALLOWED_TAGS: ['p', 'br', 'strong', 'em', 'b', 'i', 'code', 'pre', 'ul', 'ol', 'li', 'blockquote', 'a', 'img', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'span', 'div'],
            ALLOWED_ATTR: ['href', 'src', 'alt', 'title', 'target', 'rel', 'class', 'style'],
            KEEP_CONTENT: true,
            RETURN_DOM: false,
            RETURN_DOM_FRAGMENT: false
        });
        
        return sanitized;
    }

    function addMessage(role, content, imageUrl = null) {
        const message = document.createElement("div");
        message.className = `message ${role}`;

        const bubble = document.createElement("div");
        bubble.className = "bubble";
        
        // Adicionar wrapper para conte√∫do
        const contentWrapper = document.createElement("div");
        contentWrapper.className = "message-content";

        if (content) {
            if (role === "ai") {
                // Log antes de processar
                console.log('üì• Conte√∫do recebido:', {
                    tamanho: content.length,
                    primeiros100: content.substring(0, 100),
                    ultimos100: content.substring(content.length - 100)
                });
                
                // Renderizar markdown e sanitizar
                const htmlContent = sanitizeHTML(content);
                
                // Log ap√≥s processar
                console.log('üì§ HTML gerado:', {
                    tamanho: htmlContent.length,
                    primeiros200: htmlContent.substring(0, 200),
                    ultimos200: htmlContent.substring(htmlContent.length - 200)
                });
                
                contentWrapper.innerHTML = htmlContent;
                
                // Verificar o que foi renderizado no DOM
                setTimeout(() => {
                    console.log('üé® Texto final no DOM:', {
                        tamanhoTexto: bubble.textContent.length,
                        tamanhoHTML: bubble.innerHTML.length,
                        visivelNaTela: bubble.offsetHeight > 0
                    });
                }, 100);
            } else {
                contentWrapper.textContent = content;
            }
        }

        bubble.appendChild(contentWrapper);

        if (imageUrl) {
            const img = document.createElement("img");
            img.src = imageUrl;
            img.alt = "Imagem do chat";
            bubble.appendChild(img);
        }

        message.appendChild(bubble);
        chat.appendChild(message);
        
        // Scroll suave para o final
        setTimeout(() => {
            chat.scrollTop = chat.scrollHeight;
        }, 100);
    }

    function addLoadingMessage() {
        const message = document.createElement("div");
        message.className = "message loading";
        message.id = "loading-message";

        const bubble = document.createElement("div");
        bubble.className = "bubble";

        const spinner = document.createElement("div");
        spinner.className = "loading-spinner";
        spinner.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div>';

        bubble.appendChild(spinner);
        message.appendChild(bubble);
        chat.appendChild(message);
        chat.scrollTop = chat.scrollHeight;
    }

    function removeLoadingMessage() {
        const loadingMsg = document.getElementById("loading-message");
        if (loadingMsg) loadingMsg.remove();
    }

    // ==================== ENVIO DE MENSAGEM ====================
    async function sendMessage() {
        const text = input.value.trim();
        
        if (!text && !selectedImageData) {
            showError("Digite uma mensagem ou selecione uma imagem.");
            return;
        }

        if (text.length > MAX_MESSAGE_LENGTH) {
            showError(`Mensagem muito longa (m√°x ${MAX_MESSAGE_LENGTH} caracteres).`);
            return;
        }

        if (isLoading) return;

        // Mostrar mensagem do usu√°rio
        addMessage("user", text || "(Imagem enviada)", selectedImageData);
        
        const messageToSend = text;
        const imageToSend = selectedImageData;
        
        // Limpar inputs
        input.value = "";
        selectedImage = null;
        selectedImageData = null;
        imageBtn.style.color = "";
        imageBtn.title = "Carregar imagem";
        updateCharCount();

        isLoading = true;
        sendBtn.disabled = true;
        addLoadingMessage();

        try {
            console.log('üì§ Enviando mensagem...');
            
            const payload = {
                message: messageToSend,
                category: categorySelect.value
            };

            if (imageToSend) {
                payload.image = imageToSend;
            }

            const res = await fetch("/api/chat", {
                method: "POST",
                headers: getAuthHeaders(),
                body: JSON.stringify(payload)
            });

            removeLoadingMessage();

            // Tratamento de erros HTTP
            if (!res.ok) {
                if (res.status === 401) {
                    handleUnauthorized();
                    return;
                } else if (res.status === 403) {
                    showError("Voc√™ n√£o tem permiss√£o para acessar este recurso.");
                    addMessage("error", "‚ùå Acesso negado.");
                    return;
                } else if (res.status === 429) {
                    showError("Muitas requisi√ß√µes. Aguarde um momento.");
                    addMessage("error", "‚ùå Limite de requisi√ß√µes atingido. Aguarde alguns instantes.");
                    return;
                }
                throw new Error(`HTTP ${res.status}`);
            }

            const data = await res.json();
            console.log('‚úì Resposta recebida:', data);
            console.log('üìä An√°lise da resposta:', {
                sucesso: data.success,
                temResponse: !!data.response,
                temText: !!data.text,
                tamanhoResponse: data.response?.length || 0,
                tamanhoText: data.text?.length || 0,
                tipo: data.tipo
            });

            // Verificar resposta
            if (data.error) {
                addMessage("error", `‚ùå Erro: ${data.error}`);
                return;
            }

            // Adaptar resposta para diferentes formatos
            const responseText = data.response || data.text || "N√£o consegui gerar resposta.";
            const responseImage = data.image || null;

            console.log('üìù Texto que ser√° adicionado:', {
                tamanho: responseText.length,
                inicio: responseText.substring(0, 100),
                fim: responseText.substring(responseText.length - 100)
            });

            addMessage("ai", responseText, responseImage);
            console.log('‚úì Mensagem adicionada ao chat');

        } catch (err) {
            removeLoadingMessage();
            console.error("‚ùå Erro:", err);
            addMessage("error", `‚ùå Erro ao se comunicar com o servidor: ${err.message}`);
        } finally {
            isLoading = false;
            sendBtn.disabled = false;
        }
    }

    // ==================== HIST√ìRICO ====================
    async function loadChatHistory() {
        try {
            console.log('üìú Carregando hist√≥rico...');
            
            const res = await fetch("/api/chat/history", {
                method: "GET",
                headers: getAuthHeaders()
            });

            if (res.status === 401) {
                handleUnauthorized();
                return;
            }

            if (!res.ok) {
                console.warn('Erro ao carregar hist√≥rico:', res.status);
                return;
            }

            const data = await res.json();
            console.log('Hist√≥rico recebido:', data);

            if (data.chats && Array.isArray(data.chats) && data.chats.length > 0) {
                console.log(`‚úì ${data.chats.length} mensagens carregadas`);
                
                data.chats.forEach(item => {
                    addMessage("user", item.mensagem_usuario);
                    addMessage("ai", item.resposta_ia);
                });
            } else {
                console.log('Nenhum hist√≥rico encontrado');
            }
        } catch (err) {
            console.warn("Erro ao carregar hist√≥rico:", err);
        }
    }

    // ==================== NOTIFICA√á√ïES ====================
    function showError(message) {
        console.error('‚ùå', message);
        
        const toast = document.createElement("div");
        toast.className = "error-toast";
        toast.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
        document.body.appendChild(toast);

        setTimeout(() => {
            toast.style.animation = "slideInRight 0.3s ease-out reverse";
            setTimeout(() => toast.remove(), 300);
        }, 4000);
    }

    // Log inicial
    console.log('üîê Estado da autentica√ß√£o:');
    console.log('Token presente:', !!localStorage.getItem(TOKEN_KEY));
    console.log('Usu√°rio:', localStorage.getItem('user_data'));
</script>

</body>
</html>